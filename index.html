<!-- The index page of David and Phil's photo voting application -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="shortcut icon" href="temp_favicon.ico">
<title>Picture voting machine</title>
<script src="js/jquery-2.2.1.js"></script>
<link rel="stylesheet" href="bootstrap-3.3.6-dist/css/bootstrap.min.css">
<script>
	var globalResponseObj;

	function displayImageInfo(imageObj) {
		// Creating the title DOM element.
		var title = document.createElement("h4");
		title.innerHTML = "TITLE: " + imageObj.title;
		document.body.appendChild(title);
		document.body.appendChild(document.createElement("br"));

		// Creting the image DOM element.
		var img = document.createElement("img");
		img.src = imageObj.url;
		img.alt = "You should be seeing an image from this url: " + imageObj.url;
		document.body.appendChild(img);

		// Creating a list of tags.
		var tagList = document.createElement("ul");
		document.body.appendChild(tagList);

		// Creating tags based on the length of the tag category array.
		var tag = document.createElement("li");
		if (imageObj.tags != null) {
			tag.innerHTML = imageObj.tags;
		} else {
			tag.innerHTML = "You don't got not tags on this image.";
			console.log("tags: null");
		}
		document.getElementsByTagName('ul')[0].appendChild(tag);

		// Creating a button to submit votes and tags.
		var submitButton = document.createElement("button");
		submitButton.type = "button";
		submitButton.innerHTML = "SUBMIT TAGS, VOTE and NEXT!";
		submitButton.id = 
		document.body.appendChild(submitButton);
		document.getElementsByTagName('button')[1].onclick = voteAndUpdate;

		globalResponseObj = imageObj;
	}

	function checkStatePut() {
		if (this.readyState === 4 && this.status === 200) {
			consolelog("Now printing the global response object");
		}
	}

	function voteAndUpdate() {
		console.log("firing voteAndUpdate");
		var xhr = new XMLHttpRequest();
		var url = "http://192.168.56.101:8081/images";


		xhr.open('PUT', url, true);
		xhr.onreadystatechange = checkStatePut;
 		xhr.send();
	}

	function checkState() {
		if (this.readyState === 4 && this.status === 200) {
			console.log("readyState === 4 and status 200");

			var imageObj = JSON.parse(this.responseText);
			console.log(imageObj);
			console.log("After the imageObj console.log");
			displayImageInfo(imageObj);
		}
	}

	window.onload = function() {
		console.log("The onload funtion has fired.");

		// Preloading the first image url, tags
		if (window.XMLHttpRequest) {
			httpRequest = new XMLHttpRequest();
		}
		else if (window.ActiveXObject) {
			try {
				httpRequest = new ActiveXObject("Msxm12.XMLHTTP");
			}
			catch (e) {
				try {
					httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
				}
				catch (e) {}
			}
		}	// End of else if statement.

		var url = "http://192.168.56.101:8081/images";	// Gets a single image JSON.

		this.httpRequest.onreadystatechange = checkState;
		this.httpRequest.open('GET', url, true);
		this.httpRequest.send();
	}
</script>
</head>
<body>
	<h2>Welcome to the picture voting app</h2>
	<br />
	<button type="button" onclick="voteAndUpdate()">Test puts onclick!</button>

</body>
</html>
